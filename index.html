<html>
  <head>
    <script src="https://vk.com/js/api/xd_connection.js?2" type="text/javascript"></script>
    <script src="request.js"></script>
    <script type="text/javascript">
      var parts = window.location.href.split('&hash=');
      var params = decodeURIComponent(parts[parts.length - 1]).split('&');
      var access_token = location.href.split('access_token=')[1].split('&')[0];
      var host = params[1] + '/postPhoto';
      var serverDest = host + '?access_token=' + access_token + '&text_id=' + params[0];
      VK.init(function() { 
        VK.addCallback('onSettingsChanged', function() {
          request({
            url: serverDest,
            json: true
          }, function (err, res, body) {
            if(body.success == true) {
              document.querySelector('#message').innerHTML = 'Предсказание усешно опубликовано на вашей странице. Теперь вы участвуете в конкурсе!'
              return;
            }
            document.querySelector('#message').innerHTML = 'Произошла ошибка вовремя публикации предсказания на вашей странице. Участие в конкурсе невозможно.'
          })
        });
        VK.callMethod('showSettingsBox', 8196);
      }, function() {}, '5.92'); 
    </script>
  </head>
  <body>
    <h1 id="message"></h1>
  </body>
</html>