<html>
  <head>
    <script src="https://vk.com/js/api/xd_connection.js?2" type="text/javascript"></script>
    <script src="request.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var parts = window.location.href.split('&hash=');
      var params = decodeURIComponent(parts[parts.length - 1]).split('&');
      var access_token = location.href.split('access_token=')[1].split('&')[0];
      var host = params[1] + '/postPhoto';
      var serverDest = host + '?access_token=' + access_token + '&text_id=' + params[0];
      VK.init(function() { 
        VK.addCallback('onSettingsChanged', function() {
          $.ajax({
            url: serverDest,
            crossDomain: true,
            xhrFields: {
              withCredentials: true
            }
          }).done(function (body) {
            console.log(body);
            if(body.attachment) {
              VK.api('wall.post', {
                message: '#МодульГод вместе с @modulbank (Модульбанк)',
                attachments: body.attachment,
                v: '5.73'
              }, function (data) {
                if(data.response) {
                  document.querySelector('#message').innerHTML = 'Предсказание опубликовано на вашей стене. Теперь вы участвуете в конкурсе!'
                  return;
                }
                document.querySelector('#message').innerHTML = 'Произошла ошибка при публикации предсказания на вашей стене. Участие в конкурсе невозможно!'
              });
            }
          })
        });
        VK.callMethod('showSettingsBox', 8192 | 4 | 65536);
      }, function() {}, '5.92'); 
    </script>
  </head>
  <body>
    <h1 id="message"></h1>
  </body>
</html>